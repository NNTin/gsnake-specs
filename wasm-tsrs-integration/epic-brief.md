# Epic Brief: Stable Core Interface for wasm-bindgen + ts-rs

## Summary

This epic establishes a strict, stable interface between the Rust game engine core and the Svelte client. We are explicitly accepting breaking changes during this refactor to set a new baseline contract. The contract is web-client first and wasm-focused; multi-client support is out of scope until a second client exists. We will rely on shared domain types generated by ts-rs and remove manual normalization/mapping in the web layer. The wasm boundary returns serialized domain payloads with strict enum strings, and all errors are surfaced via a typed error payload.

## Context & Problem

The current integration between Rust core and the Svelte client changes often, creating friction and rework. As the engine evolves, the UI must keep up with shifting shapes and manual mappings. This slows delivery and will only worsen as more clients are added. We need a stable contract that changes only in minor releases to allow both sides to evolve safely.

## Strict Direction (Decisions)

- Breaking changes are allowed for this epic to establish a new baseline contract; old compatibility paths and normalization layers will be removed.
- The contract is web-first and wasm-only; non-web clients are out of scope for this epic.
- The UI renders strictly from `Frame.grid`; `Frame.snake` is removed from the contract to avoid ambiguity.
- `Direction`, `CellType`, and `GameStatus` are serialized as string enums and must match ts-rs output; numeric or object enum representations are not accepted.
- Errors at the wasm boundary are returned as a typed error payload (e.g., `ContractError` with `kind` and `message`), not ad-hoc strings.

## Success Criteria

- `gsnake-web/types/models.ts` is the single source of truth for TS types, generated from Rust with no hand-written duplicates.
- Web integration compiles without runtime normalization of enums or payloads.
- `WasmGameEngine` exposes a strict API with deterministic rejection reasons for invalid input.
